<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Secret Notes üíú</title>
    <style>
        /* === LAVENDER THEME === */
        body { font-family: 'Segoe UI', sans-serif; background-color: #f3e5f5; padding: 0; margin: 0; padding-bottom: 80px; }
        
        /* Nav & Standard Styles */
        .menu-btn { position: fixed; top: 15px; left: 15px; font-size: 20px; cursor: pointer; color: #6a1b9a; background: white; padding: 8px 10px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); z-index: 1000; }
        
        /* Sidebar Menu */
        .side-menu { height: 100%; width: 0; position: fixed; z-index: 2000; top: 0; left: 0; background-color: rgba(255, 255, 255, 0.98); overflow-x: hidden; transition: 0.3s; box-shadow: 2px 0 10px rgba(0,0,0,0.1); padding-top: 60px; }
        .side-menu a { padding: 15px 25px; text-decoration: none; font-size: 18px; color: #6a1b9a; display: block; font-weight: bold; border-bottom: 1px solid #e1bee7; }
        .side-menu .close-btn { position: absolute; top: 10px; right: 20px; font-size: 30px; cursor: pointer; color: #6a1b9a; }

        .header { text-align: center; margin-top: 70px; margin-bottom: 20px; }
        h2 { color: #6a1b9a; font-family: 'Courier New', monospace; margin: 0; }
        p { font-size: 12px; color: #8e24aa; }

        /* === NOTES GRID === */
        .notes-container {
            padding: 20px; display: grid; grid-template-columns: 1fr 1fr; gap: 15px;
        }

        .note-card {
            background: #fffdf0; /* Off-white */
            padding: 15px; border-radius: 15px;
            box-shadow: 0 4px 8px rgba(106, 27, 154, 0.1);
            border-top: 4px solid #ab47bc; /* Lavender tape effect */
            height: 120px; overflow: hidden; position: relative;
            cursor: pointer; transition: 0.3s;
        }
        .note-card:hover { transform: translateY(-3px); }
        
        .note-title { font-weight: bold; color: #4a148c; margin-bottom: 5px; font-size: 16px; }
        .note-preview { font-size: 12px; color: #666; font-family: 'Courier New', monospace; line-height: 1.4; }
        .note-date { position: absolute; bottom: 10px; right: 10px; font-size: 10px; color: #999; }

        /* === ADD BUTTON (Floating) === */
        .add-btn {
            position: fixed; bottom: 20px; right: 20px;
            width: 60px; height: 60px; background: linear-gradient(135deg, #ab47bc, #8e24aa);
            color: white; border-radius: 50%; border: none; font-size: 30px;
            box-shadow: 0 5px 15px rgba(142, 36, 170, 0.4); cursor: pointer;
            display: flex; justify-content: center; align-items: center; z-index: 100;
        }

        /* === NOTEPAD MODAL (The Lined Paper) === */
        #noteModal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(243, 229, 245, 0.9); backdrop-filter: blur(5px);
            z-index: 3000; justify-content: center; align-items: center;
        }

        .notepad {
            background: #fffdf0; /* Off-white paper */
            width: 90%; max-width: 400px; height: 80vh;
            border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            display: flex; flex-direction: column; overflow: hidden;
            border: 1px solid #e1bee7;
        }

        .notepad-header {
            padding: 15px; background: #f3e5f5; border-bottom: 2px dashed #ce93d8;
            display: flex; justify-content: space-between; align-items: center;
        }
        .title-input {
            width: 70%; border: none; background: transparent; font-size: 18px; 
            font-weight: bold; color: #6a1b9a; outline: none;
        }

        /* === THE LINED PAPER FIX === */
        .paper-body {
            flex: 1; padding: 0 20px; overflow: hidden; /* Scroll handled by textarea */
            background-color: #fffdf0;
        }
        
        .body-textarea {
            width: 100%; height: 100%; border: none; 
            
            /* Lines move seamlessly with text */
            background-color: transparent;
            background-image: linear-gradient(transparent 95%, #e1bee7 95%); 
            background-size: 100% 30px; 
            background-attachment: local; /* Critical Fix */
            
            font-family: 'Courier New', cursive; 
            font-size: 16px; 
            line-height: 30px; /* Matches bg-size */
            padding-top: 0;
            
            color: #4a148c; outline: none; resize: none; 
        }

        .notepad-footer {
            padding: 15px; background: #fffdf0; display: flex; justify-content: space-between;
        }

        .action-btn {
            padding: 8px 20px; border-radius: 20px; border: none; font-weight: bold; cursor: pointer;
        }
        .btn-save { background: #8e24aa; color: white; }
        .btn-close { background: #ffcdd2; color: #c62828; }
        .btn-delete { background: transparent; color: #d32f2f; font-size: 20px; cursor: pointer; border: none;}

    </style>
</head>
<body>

    <div class="menu-btn" onclick="openNav()">‚ò∞</div>
    <div id="mySidenav" class="side-menu">
        <a href="javascript:void(0)" class="close-btn" onclick="closeNav()">&times;</a>
        <a href="index.html">üè† Dashboard</a>
        
        <a href="notes.html">üíú Secret Notes</a>

        <a href="routine.html">üìÖ Routine</a>
        <a href="quiz.html">üìù Quiz</a>
        <a href="assignment.html">üìÇ Assignments</a>
        <a href="mid.html">üìñ Mid Term</a>
        <a href="final.html">üéì Final Exam</a>
    </div>

    <div class="header">
        <h2>üíú My Secret Notes üíú</h2>
        <p>Write your heart out...</p>
    </div>

    <div class="notes-container" id="notesList"></div>

    <button class="add-btn" onclick="openNoteModal()">+</button>

    <div id="noteModal">
        <div class="notepad">
            <div class="notepad-header">
                <input type="text" id="noteTitle" class="title-input" placeholder="Note Title...">
                <button class="btn-delete" onclick="deleteCurrentNote()">üóëÔ∏è</button>
            </div>
            
            <div class="paper-body">
                <textarea id="noteBody" class="body-textarea" placeholder="Start writing here..."></textarea>
            </div>

            <div class="notepad-footer">
                <button class="action-btn btn-close" onclick="closeNoteModal()">Cancel</button>
                <button class="action-btn btn-save" onclick="saveNote()">Save üíú</button>
            </div>
        </div>
    </div>

    <script>
        // --- DATA ---
        let notes = [];
        let currentEditingId = null;

        // --- LOCAL STORAGE ---
        function loadNotes() {
            const saved = localStorage.getItem("myNotesData");
            if (saved) notes = JSON.parse(saved);
            renderNotes();
        }

        // --- RENDER ---
        function renderNotes() {
            const container = document.getElementById("notesList");
            container.innerHTML = "";

            notes.forEach(note => {
                const card = document.createElement("div");
                card.className = "note-card";
                card.onclick = () => openNoteModal(note.id);

                card.innerHTML = `
                    <div class="note-title">${note.title || "Untitled"}</div>
                    <div class="note-preview">${note.body.substring(0, 50)}...</div>
                    <div class="note-date">${note.date}</div>
                `;
                container.appendChild(card);
            });
        }

        // --- MODAL LOGIC ---
        function openNoteModal(id = null) {
            const modal = document.getElementById("noteModal");
            const titleInput = document.getElementById("noteTitle");
            const bodyInput = document.getElementById("noteBody");

            modal.style.display = "flex";
            currentEditingId = id;

            if (id) {
                const note = notes.find(n => n.id === id);
                titleInput.value = note.title;
                bodyInput.value = note.body;
            } else {
                titleInput.value = "";
                bodyInput.value = "";
            }
        }

        function closeNoteModal() {
            document.getElementById("noteModal").style.display = "none";
        }

        // --- SAVE / DELETE ---
        function saveNote() {
            const title = document.getElementById("noteTitle").value;
            const body = document.getElementById("noteBody").value;
            const date = new Date().toLocaleDateString();

            if (!body.trim()) {
                alert("Please write something! ü•∫");
                return;
            }

            if (currentEditingId) {
                const index = notes.findIndex(n => n.id === currentEditingId);
                notes[index] = { id: currentEditingId, title, body, date };
            } else {
                const newId = Date.now();
                notes.push({ id: newId, title, body, date });
            }

            localStorage.setItem("myNotesData", JSON.stringify(notes));
            renderNotes();
            closeNoteModal();
            syncToCloud(); 
        }

        function deleteCurrentNote() {
            if (currentEditingId && confirm("Delete this note? üíî")) {
                notes = notes.filter(n => n.id !== currentEditingId);
                localStorage.setItem("myNotesData", JSON.stringify(notes));
                renderNotes();
                closeNoteModal();
                syncToCloud();
            }
        }

        function openNav() { document.getElementById("mySidenav").style.width = "250px"; }
        function closeNav() { document.getElementById("mySidenav").style.width = "0"; }

        window.onload = function() {
            loadNotes();
            fetchNotesFromCloud();
        };

    </script>

    <script>
        const REMOTE_BIN_ID = "697a8010d0ea881f408e87d7"; 
        const REMOTE_API_KEY = "$2a$10$vhszPYO/HWMSbnMiDUcq7eIW6i8BecKgdG6QteMm/FPJ/22fP/VBS";

        async function syncToCloud() {
            try {
                // 1. Fetch current data to preserve other keys (routine, quiz, etc)
                let response = await fetch(`https://api.jsonbin.io/v3/b/${REMOTE_BIN_ID}/latest`, {
                    headers: { 'X-Master-Key': REMOTE_API_KEY }
                });
                let result = await response.json();
                let currentData = result.record;

                // 2. Update ONLY the notes array
                currentData.notes = notes; 

                // 3. Save back
                await fetch(`https://api.jsonbin.io/v3/b/${REMOTE_BIN_ID}`, {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json', 'X-Master-Key': REMOTE_API_KEY },
                    body: JSON.stringify(currentData)
                });
                console.log("Notes synced to cloud! ‚òÅÔ∏è");
            } catch (error) {
                console.log("Sync failed (Offline?)");
            }
        }
        
        async function fetchNotesFromCloud() {
            try {
                let response = await fetch(`https://api.jsonbin.io/v3/b/${REMOTE_BIN_ID}/latest`, {
                    headers: { 'X-Master-Key': REMOTE_API_KEY }
                });
                if(response.ok) {
                    let result = await response.json();
                    if(result.record.notes) {
                        notes = result.record.notes;
                        localStorage.setItem("myNotesData", JSON.stringify(notes));
                        renderNotes();
                    }
                }
            } catch(e) {}
        }
    </script>
</body>
</html>
